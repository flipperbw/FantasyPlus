"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}chrome.runtime.sendMessage({request:"valid_site"});var dlog={ERROR:1,WARN:2,LOG:3,INFO:4,DEBUG:5,VERBOSE:6,empty:function(){},set level(e){this.error=e>=this.ERROR?console.error.bind(window.console):this.empty,this.warn=e>=this.WARN?console.warn.bind(window.console):this.empty,this.log=e>=this.LOG?console.log.bind(window.console):this.empty,this.info=e>=this.INFO?console.log.bind(window.console):this.empty,this.debug=e>=this.DEBUG?console.log.bind(window.console):this.empty,this.verbose=e>=this.VERBOSE?console.log.bind(window.console):this.empty,this.loggingLevel=e},get level(){return this.loggingLevel}};dlog.level=dlog.WARN,jQuery.noConflict();function isObj(e){return jQuery.isPlainObject(e)&&!jQuery.isEmptyObject(e)}function goodVal(e,a,r){return e.hasOwnProperty(a)&&jQuery.type(e[a])===r}function override(e,t,a){e[t]=a(e[t])}function applyAfter(e){return function(t){return function(){var a=t.apply(this,arguments);return e.apply(this,arguments),a}}}function applyBefore(e){return function(t){return function(){return e.apply(this,arguments),t.apply(this,arguments)}}}function applyCompose(e){return function(t){return function(){return e.call(this,t.apply(this,arguments))}}}function getLocalStorage(e,t){return new Promise(function(a,n){chrome.storage.local.get(e,function(e){t(e,a,n)})})}function setLocalStorage(e){return new Promise(function(t){chrome.storage.local.set(e,function(){t()})})}var domParse=new DOMParser;function cleanHTML(e){var t=domParse.parseFromString(e,"text/html"),a=t.querySelectorAll("head, img, svg, link, style");return a.forEach(function(e){e.remove()}),t.documentElement.innerHTML}var storageUserSettingsKey="fp_user_settings";function clearStoredData(){return getLocalStorage(null,function(e,t){jQuery.each(e,function(e){e!==storageUserSettingsKey&&chrome.storage.local.remove(e)}),t()})}var storageDataResetKey="fp_data_reset",res_num=2;function resetOldData(){return getLocalStorage(storageDataResetKey,function(e,t){var a=e[storageDataResetKey];!a||a<res_num?(dlog.log("Clearing stored data"),clearStoredData().then(function(){setLocalStorage({fp_data_reset:res_num}).then(function(){t()})})):t()})}var alldata,custom_cols,observer,observer_disconned,league_id,league_settings_url,storage_translation_data,activity_data,activity_data_current_season_site,onMatchupPreviewPage,onClubhousePage,onFreeAgencyPage,onGeneralProjPage,storageLeagueKey,storageLeagueUpdateKey,storagePlayerKey,storageUpdateKey,storageUpdateTypeKey,storageTranslationKey,storageTranslationUpdateKey,playerTable,player_table_selector,player_table_body,player_table_body_selector,player_table_header,player_table_header_selector,player_table_rows,player_table_row_selector,proj_head,player_table_header_proj_selector,header_index,player_name_selector,base_table_selector,base_table,page_menu_selector,page_menu,pts_total_selector,pts_total,ld_selector,hasProjTotals,hasPlayerTable,hasProjectionTable,depth_data,depth_data_current_week,fp="FantasyPlus",num_rgx="\\d+",fetch_fail=!1,idp_fetch_fail=!1,depth_fail=!1,total_players=0,total_players_depth=0,user_settings={},updated_times={},updated_types={},updated_league=0,updated_depth=0,ajax_timeout=6e3,show_proj=!0,show_rank=!0,show_ros=!0,show_std=!0,show_depth=!0,show_spark=!0,show_avg=!0,show_med=!0,show_current=!0,check_minutes=30,check_minutes_avg=1440,check_minutes_avg_done=20,check_minutes_avg_live=1,check_minutes_depth=120,experts={proj:{selection:["all"]},rank:{selection:["all"],num:{top:10,updated:1}},ros:{selection:["all"],num:{top:5,updated:7}}},remove_ads=!0,fix_css=!0,season_start_map={2014:[8,2],2015:[8,8],2016:[8,6],2017:[8,5],2018:[8,4],2019:[8,3],2020:[8,8]},expected_player={QB:{pass_yds:254.3,pass_tds:1.6,pass_ints:.83,pass_att:35.25,pass_cmp:22.18,rush_yds:13.82,rush_tds:.12,rush_att:3.35,fumbles:.18},RB:{rush_yds:45.53,rush_tds:.28,rush_att:10.95,rec_yds:16.07,rec_att:1.97,rec_tds:.07,fumbles:.07},WR:{rec_yds:49.83,rec_att:3.78,rec_tds:.31,fumbles:.03},TE:{rec_yds:31.61,rec_att:2.87,rec_tds:.26,fumbles:.02},"D/ST":{def_sack:2.33,def_ff:.86,def_int:.86,def_td:.21,def_fr:.6,def_pa:22.82,def_tyda:352.67,def_safety:.02},K:{xpt:2.16,fg:1.65,fga:1.95},LB:{Scks:.26,FumFrc:.08,Tack:4.11,Asst:1.78,PassDef:.22,Int:.04,DefTD:.01,Fum:.04},DL:{Scks:.32,FumFrc:.06,Tack:2.14,Asst:.95,PassDef:.1,Int:.01,DefTD:0,Fum:.03},DB:{Scks:.03,FumFrc:.05,Tack:3.84,Asst:.92,PassDef:.58,Int:.12,DefTD:.02,Fum:.03}},projDefs={settingNames:["pass_yds","pass_tds","pass_ints","pass_att","pass_cmp","pass_icmp","pass_firstdown","rush_yds","rush_tds","rush_att","rush_firstdown","rec_yds","rec_att","rec_tds","rec_firstdown","xpt","fg","fga","fgm","fumbles"],defDict:{sk:"def_sack",ff:"def_ff",int:"def_int",deftd:"def_td",fr:"def_fr",pa:"def_pa",ya:"def_tyda",sf:"def_safety"},idpDict:{sk:"Scks",ff:"FumFrc",tka:"Tack",tks:"Asst",pd:"PassDef",int:"Int",deftd:"DefTD",fr:"Fum"},first_down_pct:{pass:{QB:.349},rush:{QB:.304,RB:.205,WR:.317},rec:{RB:.353,WR:.627,TE:.567}}},current_date=new Date,current_time=current_date.getTime(),current_month=current_date.getMonth(),current_year=current_date.getFullYear(),current_season=current_year,current_season_avg=current_year,current_season_avg_week=current_year;(5>current_month||!season_start_map[current_year]&&season_start_map[current_year-1])&&(current_season-=1);var seasonstart;try{seasonstart=new Date(current_season,season_start_map[current_season][0],season_start_map[current_season][1],4)}catch(t){throw"FantasyPlus: Season "+current_season+" does not exist in records"}var seasonstart_avg=seasonstart,seasonstart_avg_week=seasonstart,oneweekbefore=new Date(seasonstart.getTime());oneweekbefore.setDate(oneweekbefore.getDate()-7),current_date<oneweekbefore&&(current_season_avg-=1,seasonstart_avg=new Date(current_season_avg,season_start_map[current_season_avg][0],season_start_map[current_season_avg][1],4)),current_date<seasonstart&&(current_season_avg_week-=1,seasonstart_avg_week=new Date(current_season_avg_week,season_start_map[current_season_avg_week][0],season_start_map[current_season_avg_week][1],4));var current_week=Math.max(Math.ceil((current_date-seasonstart)/864e5/7),1),current_week_avg=Math.max(Math.ceil((current_date-seasonstart_avg_week)/864e5/7),1),team_abbrevs={"Seattle Seahawks":"SEA","Carolina Panthers":"CAR","Arizona Cardinals":"ARI","Denver Broncos":"DEN","Los Angeles Rams":"LAR","Houston Texans":"HOU","Kansas City Chiefs":"KC","Cincinnati Bengals":"CIN","New England Patriots":"NE","Minnesota Vikings":"MIN","New York Jets":"NYJ","Philadelphia Eagles":"PHI","Green Bay Packers":"GB","Buffalo Bills":"BUF","Pittsburgh Steelers":"PIT","Baltimore Ravens":"BAL","Las Vegas Raiders":"LV","Jacksonville Jaguars":"JAC","Miami Dolphins":"MIA","Detroit Lions":"DET","Tennessee Titans":"TEN","Cleveland Browns":"CLE","San Francisco 49ers":"SF","New York Giants":"NYG","Chicago Bears":"CHI","Tampa Bay Buccaneers":"TB","Washington Football Team":"WAS","Atlanta Falcons":"ATL","Los Angeles Chargers":"LAC","Indianapolis Colts":"IND","New Orleans Saints":"NO","Dallas Cowboys":"DAL"},player_name_fix={"Stevie Johnson":"Steve Johnson","Ha Ha Clinton-Dix":"Hasean Clinton-Dix","Corey Brown":"Philly Brown","Boobie Dixon":"Anthony Dixon","Wil Lutz":"Will Lutz","MarQuies Gray":"MarQueis Gray","Jerry Attaochu":"Jeremiah Attaochu","Kahlil Mack":"Khalil Mack","Justin March-Lillard":"Justin March","Odell Beckham":"Odell Beckham Jr.","A.J. McCarron":"AJ McCarron","A.J. Derby":"AJ Derby","E.J. Manuel":"EJ Manuel","Jurell Casey":"Jurrell Casey","Johnathan Hankins":"Jonathan Hankins","Malcolm Brown":"Malcom Brown","Dante Fowler":"Dante Fowler Jr.","Vic Beasley Jr.":"Vic Beasley","Nickell Robey":"Nickell Robey-Coleman","Terrod Ward":"Terron Ward","Steven Hauschka":"Stephen Hauschka","Stephen Hauschka":"Steven Hauschka","Adoree' Jackson":"Adoree Jackson","Daniel Sorensen":"Daniel Sorenson","Johnathan Cyprien":"Jonathan Cyprien"},player_name_translations={Christopher:"Chris",Chris:"Christopher",Benjamin:"Benny",Benny:"Benjamin",Tim:"Timothy",Timothy:"Tim",Rob:"Robert",Robert:"Rob",Mike:"Michael",Michael:"Mike",Mitchell:"Mitch",Mitch:"Mitchell",John:"Johnathan",Johnathan:"John",Jon:"Jonathan",Jonathan:"Jon",Matt:"Matthew",Matthew:"Matt",Zach:"Zachary",Zachary:"Zach"},player_position_fix={"Ty Montgomery":"RB","Jadeveon Clowney":"LB","Derrick Morgan":"LB","Vic Beasley":"LB","Shea McClellin":"LB","Trent Murphy":"LB","Kevin Dodd":"LB","Lorenzo Alexander":"LB","Ryan Kerrigan":"LB","Preston Smith":"LB","Su'a Cravens":"DB","Jabaal Sheard":"DL","Frank Clark":"DL","Khalil Mack":"LB","Melvin Ingram":"DE"},player_position_fix_depth={"Derrick Morgan":"LB","Vic Beasley":"LB","Shea McClellin":"LB","Trent Murphy":"LB","Kevin Dodd":"LB","Su'a Cravens":"LB","Bruce Irvin":"LB","Ryan Kerrigan":"LB","Preston Smith":"LB","Tyrann Mathieu":"S","Lamarcus Joyner":"S","Jadeveon Clowney":"DE","Jabaal Sheard":"DE","Frank Clark":"DE","Emmanuel Ogbah":"DE","Dwight Freeney":"DE","Timmy Jernigan":"DE","Jaye Howard":"DE","Chris Baker":"DE","Kendall Langford":"DE","Adolphus Washington":"DE","Robert Nkemdiche":"DE","DaQuan Jones":"DE","Yannick Ngakoue":"DE","Melvin Ingram":"DE","Cameron Heyward":"DE","Aaron Donald":"DE","Akiem Hicks":"DE"},player_position_fix_sharks={"Su'a Cravens":"DB","Khalil Mack":"LB","Bruce Irvin":"DL"},team_abbrev_fix_fleaflicker={LA:"LAR"},off_positions_proj=["qb","rb","wr","te","k","dst"],def_positions_proj=["8","9","10"],all_positions_proj=off_positions_proj.concat(def_positions_proj),all_positions_rank=["qb","rb","wr","te","k","dst","dl","lb","db"],idp_positions=["DL","LB","DB"],idp_conversion={8:"DL",9:"LB",10:"DB"},team_name_conversion={ARZ:"ARI",GBP:"GB",KCC:"KC",NEP:"NE",NOR:"NO",RAM:"LA",SDC:"SD",SFO:"SF",TBB:"TB"},fpros_proj_headers={QB:["Player","Team","pass_att","pass_cmp","pass_yds","pass_tds","pass_ints","rush_att","rush_yds","rush_tds","fumbles","fpts"],RB:["Player","Team","rush_att","rush_yds","rush_tds","rec_att","rec_yds","rec_tds","fumbles","fpts"],WR:["Player","Team","rec_att","rec_yds","rec_tds","rush_att","rush_yds","rush_tds","fumbles","fpts"],TE:["Player","Team","rec_att","rec_yds","rec_tds","fumbles","fpts"],K:["Player","Team","fg","fga","xpt","fpts"],DST:["Player","Team","def_sack","def_int","def_fr","def_ff","def_td","def_safety","def_pa","def_tyda","fpts"]},fpros_rank_headers=["Rank","WSIS","Player","Team","Matchup","Best Rank","Worst Rank","Avg Rank","Std Dev"],fpros_rank_idp_headers=["Rank","WSIS","Player","Team","Pos","Matchup","Best Rank","Worst Rank","Avg Rank","Std Dev"],fpros_ros_headers=["Rank","WSIS","Player","Team","Bye","Best Rank","Worst Rank","Avg Rank","Std Dev","ADP","vs. ADP"],fpros_ros_idp_headers=["Rank","WSIS","Player","Team","Pos","Bye","Best Rank","Worst Rank","Avg Rank","Std Dev"],depth_type_map={blue:"Starter",green:"Situational",red:"Fill-in",brown:"Fill-in",black:"Reserve"},depth_url="https://subscribers.footballguys.com/apps/depthchart.php?type=all&lite=no&exclude_coaches=yes",url_fpros="https://www.fantasypros.com/nfl",url_sharks="https://www.fantasysharks.com",url_sharks_proj=url_sharks+"/apps/bert/forecasts/projections.php",loadingDiv="<div class=\"fp-spinner-cell\"><div class=\"fp-spinner-container\"><div class=\"fp-spinner fp-spinner-1\"></div><div class=\"fp-spinner fp-spinner-2\"></div><div class=\"fp-spinner fp-spinner-3\"></div></div></div>",projDone=jQuery.Deferred(),rankDone=jQuery.Deferred(),rosDone=jQuery.Deferred(),activityDone=jQuery.Deferred(),depthDone=jQuery.Deferred(),totalsDone=jQuery.Deferred(),storageActivityKey="fp_player_activity_data",storageDepthKey="fp_depth_data",storageDepthUpdateKey="fp_last_updated_depth",storageKeys=[storageActivityKey,storageDepthKey,storageDepthUpdateKey],siteType="";function getParams(e){var t={},a=e.indexOf("?");return-1<a&&e.substr(a+1).split("&").forEach(function(e){var a=e.split("="),r=a[0],n=a[1]&&decodeURIComponent(a[1]);r in t?t[r].push(n):t[r]=[n]}),t}function getUserSettings(){return getLocalStorage(storageUserSettingsKey,function(e,t){var a=e[storageUserSettingsKey];dlog.log("user settings:"),dlog.log(a),isObj(a)&&(user_settings=jQuery.extend(!0,{},a));var r={};isObj(user_settings.columns)?r=user_settings.columns:user_settings.columns={},show_proj=r.hasOwnProperty("proj")&&show_proj?r.proj:show_proj,show_rank=r.hasOwnProperty("rank")&&show_rank?r.rank:show_rank,show_ros=r.hasOwnProperty("ros")&&show_ros?r.ros:show_ros,show_depth=r.hasOwnProperty("depth")&&show_depth?r.depth:show_depth,show_spark=r.hasOwnProperty("spark")&&show_spark?r.spark:show_spark,show_avg=r.hasOwnProperty("avg")&&show_avg?r.avg:show_avg,show_med=r.hasOwnProperty("med")&&show_med?r.med:show_med,show_current=r.hasOwnProperty("current")&&show_current?r.current:show_current;var n={};isObj(user_settings.update_freq)?n=user_settings.update_freq:user_settings.update_freq={},jQuery.each(n,function(e,t){isObj(t)||(t={});var a=t.time,r=t.typ;if(a&&r){var n=a;"h"===r&&(n*=60),"player"===e&&(check_minutes=Math.max(n,1))}}),isObj(user_settings.experts)?experts=user_settings.experts:user_settings.experts={};var s={};isObj(user_settings.misc)?s=user_settings.misc:user_settings.misc={};var o=s.remove_ads,l=s.fix_css;"undefined"!=typeof o&&(remove_ads=o),"undefined"!=typeof l&&(fix_css=l),t()})}function isDataCurrent(t){function a(e){var t=check_minutes,a=0;if("league"===e)a=updated_league;else if("translation"===e)a=updated_translation;else if("depth"===e){if(!show_depth)return!0;t=check_minutes_depth,a=updated_depth}else{if("proj"===e&&!show_proj)return!0;if("rank"===e&&!show_rank)return!0;if("ros"===e&&!show_ros)return!0;if(isObj(updated_times)){a=updated_times[e];var n=e,s=experts[n]||{},o=s.selection||"none",l=o.toString();if("rank"===n||"ros"===n){var i=s.num||{},d=i.top||10,p=i.updated||7;l+="-"+d+"-"+p}dlog.log(l),updated_types[n]!==l&&(dlog.log("Different update type for: "+n+", stored is: "+updated_types[n]+", want: "+l),a=0)}}var c=!1;return c=!!parseFloat(a)&&current_time-a<60000*t,!1==c&&dlog.log(e+" is out of date: "+a),c}if(!t||!(Array.isArray(t)||"string"==typeof t)||0>=t.length)return!1;if(Array.isArray(t)){for(var r=!0,n=0;n<t.length;n++)!1===a(t[n])&&(r=!1);return r}return a(t)}function isActivityDataCurrent(e,t,a,n){var s,o=!0;if("league"===a)"live"===n?(dlog.info("using live"),s=check_minutes_avg_live):"done"===n?(dlog.info("using done"),s=check_minutes_avg_done):(dlog.info("using day"),s=check_minutes_avg),o=current_time-t<60000*s;else if("games"===a){var l=Math.max(Math.ceil((t-seasonstart_avg_week)/864e5/7),1);dlog.info("update week for player: "+e+": "+l),l!==current_week_avg&&(o=!1)}return!1===o&&dlog.info("Activity data out of date for player: "+e+", type is: "+a+", by: "+(current_time-t)/1e3),o}var AssignDataFromStorage=function(){var e=this;this.resolver=null,this.r=null,this._resolve=function(){e.resolver()},this._cb=function(t,a){e.resolver=a,e.r=t,alldata=t[storagePlayerKey],isObj(alldata)?(updated_times=t[storageUpdateKey],!isObj(updated_times)&&(updated_times={})):(dlog.log("Could not find alldata"),alldata={},updated_times={}),dlog.info(updated_times),updated_types=t[storageUpdateTypeKey],dlog.log(updated_types),isObj(updated_types)||(updated_types={}),depth_data=t[storageDepthKey],isObj(depth_data)||(depth_data={}),depth_data.hasOwnProperty(current_season)||(depth_data[current_season]={}),depth_data[current_season].hasOwnProperty("W"+current_week)||(depth_data[current_season]["W"+current_week]={}),depth_data_current_week=depth_data[current_season]["W"+current_week],updated_depth=isObj(depth_data_current_week)?t[storageDepthUpdateKey]:0,dlog.info("depth data:"),dlog.info(depth_data),dlog.info(updated_depth),activity_data=t[storageActivityKey],isObj(activity_data)||(activity_data={}),activity_data.hasOwnProperty(current_season)||(activity_data[current_season]={});var r=activity_data[current_season];r.hasOwnProperty(siteType)||(r[siteType]={}),activity_data_current_season_site=r[siteType];var n=t[storageLeagueKey];updated_league=t[storageLeagueUpdateKey],isObj(n)&&isDataCurrent("league")?(dlog.log("Using cache for league"),parseLeagueSettings.league_settings=n,e._resolve()):(parseLeagueSettings.league_settings={},dlog.log("Fetching league data, Updated time: "+updated_league+", Current Time: "+current_time),jQuery.get(league_settings_url,function(t){t=cleanHTML(t);var a=parseLeagueSettings.run(t),r={};r[storageLeagueKey]=a,r[storageLeagueUpdateKey]=updated_league,setLocalStorage(r).then(function(){e._resolve()})}))},this.run=function(){return getLocalStorage(storageKeys,e._cb)}},assignDataFromStorage=new AssignDataFromStorage;function resetLeagueYear(){}var UpdateStorage=function(){var e=this;this._wait=function(e,t,a){var r;dlog.log("Attempting to set new "+e+" data"),(r=jQuery).when.apply(r,_toConsumableArray(t)).done(function(){var t=a();isObj(t)?(dlog.log("Setting new "+e+" data"),chrome.storage.local.set(t,function(){resetLeagueYear()})):dlog.log("Not setting "+e+" data due to error")})},this.player=function(){var t=[projDone,rankDone,rosDone],a=function(){if(dlog.log("fetch fail: "+fetch_fail),dlog.log("idp fetch fail: "+idp_fetch_fail),!fetch_fail&&!idp_fetch_fail){var e={};return e[storagePlayerKey]=alldata,e[storageUpdateKey]=updated_times,e[storageUpdateTypeKey]=updated_types,e}return null};e._wait("player",t,a)},this.depth=function(){var t=[depthDone],a=function(){if(dlog.log("depth fail: "+depth_fail),!depth_fail){var e={};return e[storageDepthKey]=depth_data,e[storageDepthUpdateKey]=updated_depth,e}return null};e._wait("depth",t,a)},this.activity=function(){var t=[activityDone],a=function(){var e={};return e[storageActivityKey]=activity_data,e};e._wait("activity",t,a)}},updateStorage=new UpdateStorage,SetWatch=function(){var e=this;this._getPromiseList=function(){return onMatchupPreviewPage?[projDone,totalsDone]:[projDone,rankDone,rosDone,activityDone,depthDone,totalsDone]},this._watch=function(){onMatchupPreviewPage||watchForChanges.run()},this.run=function(){var t;(t=jQuery).when.apply(t,_toConsumableArray(e._getPromiseList())).done(function(){dlog.log("all done"),e._watch()})}},setWatch=new SetWatch,RunGetAllData=function(){this.run=function(){dlog.log("getting all data"),onMatchupPreviewPage?getAllData("proj"):getAllData()}},runGetAllData=new RunGetAllData,ParseLeagueSettings=function(){var e=this;this.league_settings={},this.league_data=null,this.run=function(t){return e.league_settings={},e.league_data=jQuery(t),updated_league=current_time,e.league_settings}},parseLeagueSettings=new ParseLeagueSettings;function ajaxCbPos(e){chrome.runtime.sendMessage({query:"pos",data:e},function(t){t=cleanHTML(t).trim(),e.custom_data.cb(e.custom_data.pos,t)})}function fetchPositionData(e,t,a){var r,n="",s="offense";if("rank"===t||"ros"===t){r="",("rb"===e||"wr"===e||"te"===e)&&(.5===parseLeagueSettings.league_settings.rec_att?r="half-point-ppr-":1===parseLeagueSettings.league_settings.rec_att&&(r="ppr-"));var o="";"ros"===t&&(o="ros-"),n=url_fpros+"/rankings/"+o+r+e+".php"}else-1<off_positions_proj.indexOf(e)?n=url_fpros+"/projections/"+e+".php?week="+current_week:(s="idp",n=url_sharks_proj+"?csv=1&Position="+e+"&Segment="+(627+current_week));var l={url:n,timeout:ajax_timeout,custom_data:{cb:a,source_site:n,pos:e}};if("idp"===s)ajaxCbPos(l);else{var i=experts[t]||{},d=i.selection||[];if("proj"===t&&1===d.length)ajaxCbPos(l);else if("proj"===t){l.method="get",l.data={scoring:"STD"},l.traditional=!0,ajaxCbPos(l)}else jQuery.ajax(l).done(function(e){var a=this.custom_data.cb,n=this.custom_data.pos,s=this.custom_data.source_site;e=cleanHTML(e);var o={"expert[]":[]},l=o["expert[]"];o.scoring="half-point-ppr-"===r?"HALF":"ppr-"===r?"PPR":"STD";var i=experts[t]||{},d=i.selection||[],p=i.num||{},c=p.top||10,u=p.updated||7,_=jQuery(e).find("#edit-experts #experts");if(_.length){var h=_.find("tbody tr"),f=_.find("thead tr"),g=f.find("th:first").index(),y=f.find("th.accuracy.overall:contains(In-Season)").index(),m=f.find("th.accuracy.position:contains(In-Season)").index(),v=f.find("th:contains(Date)").index();if(-1===d.indexOf("all")){var D=h.find("td").filter(function(){return"FantasyPros Staff"===jQuery(this).text()}).parents("tr").find("td:eq("+g+") input").val();jQuery.isNumeric(D)&&l.push(D);var w=-1<d.indexOf("updated"),k=-1<d.indexOf("overall"),x=-1<d.indexOf("position");if((k||x)&&c&&h.length>c){var P=-1;k?P=y:x&&(P=m),h.sort(function(e,t){var a=jQuery(t).find("td:eq("+P+")").text().replace("#","")||1/0,r=jQuery(e).find("td:eq("+P+")").text().replace("#","")||1/0;return r-a}),h=h.slice(0,c)}if(w&&u){var B=current_month+1,b=h.filter(function(){var e=jQuery(this).find("td:eq("+v+")").text(),t=current_year;B<e.split("/")[0]&&(t-=1);var a=new Date(e+" "+t);if((current_date-a)/1e3/60/60/24<u+1)return this});1<b.length?h=b:(h.sort(function(e,t){var a=jQuery(t).find("td:eq("+v+")").text(),r=jQuery(e).find("td:eq("+v+")").text(),n=current_year;B<a.split("/")[0]&&(n-=1);var s=new Date(a+" "+n),o=current_year;B<r.split("/")[0]&&(o-=1);var l=new Date(r+" "+o);return s-l}),h=h.slice(0,2))}}h.each(function(){var e=jQuery(this),t=e.find("td").eq(g).find("input").val();l.push(t)})}delete o["expert[]"];ajaxCbPos({url:s,method:"get",data:o,timeout:ajax_timeout,custom_data:{cb:a,source_site:s,pos:n}})}).fail(function(){var t=this.custom_data.cb,a=this.custom_data.source_site;fetch_fail=!0,chrome.runtime.sendMessage({request:"fetch_fail",value:a}),t(e,"error")})}}function parsesiteCSV(e){var t,a,r,n=[],s=!1;for(t=a=r=0;r<e.length;r++){var o=e[r],l=e[r+1];if(n[t]=n[t]||[],n[t][a]=n[t][a]||"",","===o&&"undefined"==typeof l&&(a++,n[t][a]=""),"\""===o&&s&&"\""===l){n[t][a]+=o,++r;continue}if("\""===o){s=!s;continue}if(","===o&&!s){++a;continue}if("\n"===o&&!s){++t,a=0;continue}n[t][a]+=o}return n}function convertFProsToCSV(e,t,a){var r=jQuery(e);r.find("thead tr:has(td)").remove(),r.find("tbody tr:not([class^=\"mpb-player\"])").remove();var n=jQuery("table#data, table#rank-data",r).first(),s=n.find("thead th:contains(\"Player\")"),o=s.clone();o.text("Team"),o.insertAfter(s);var l=n.find("tbody tr");l.each(function(e,a){var r=jQuery(a),n=r.find("td.player-label"),s=n.find("a[fp-player-name]").first().attr("fp-player-name");s||(s=n.find("a[href^=\"/nfl\"]").first().find("span.full-name").text()),s=s.trim();var o="";o="proj"===t?n.contents().filter(function(){return 3===this.nodeType}).text().trim():n.find("small:first").text().trim(),o||(o="FA");var l=jQuery("<td>"+o+"</td>");n.text(s),l.insertAfter(n)});var i;return"rank"===t?-1<idp_positions.indexOf(a)?i=fpros_rank_idp_headers:i=fpros_rank_headers:"ros"===t?-1<idp_positions.indexOf(a)?i=fpros_ros_idp_headers:i=fpros_ros_headers:"proj"==t&&(i=fpros_proj_headers[a]),n.table2CSV({delivery:"value",header:i})}function parsePos(e,t,a){if("error"!==t){var r;"proj"===e&&-1===off_positions_proj.indexOf(a)?(t=t.replace(/<\/?(html|body)>/g,""),r=idp_conversion[a]):(r=a.toUpperCase(),t=convertFProsToCSV(t,e,r));for(var n=parsesiteCSV(t),s=n[0],o=0;o<s.length;o++)s[o]=s[o].trim();var l=s.indexOf("Team"),d=s.indexOf("Player");if(-1!==l&&-1!==d)for(var p=1;p<n.length;p++){var c=n[p],u=r;if(c.length<l+1){dlog.log("Error fetching "+e),dlog.log(c),dlog.log(r);continue}var _=c[l].trim();team_name_conversion.hasOwnProperty(_)&&(_=team_name_conversion[_]);var f=c[d].trim();if("dst"===a)f=setDSTname(f),u="D/ST",_="-";else if("proj"===e&&-1<def_positions_proj.indexOf(a)){f=f.split(",")[1]+" "+f.split(",")[0],f=f.trim();var g=fixPlayerName(f,u,_,"proj");g?f=g[0]:player_name_fix.hasOwnProperty(f)&&(f=player_name_fix[f]),player_position_fix_sharks.hasOwnProperty(f)&&(u=player_position_fix_sharks[f])}f=f.trim().toUpperCase();var y=f+"|"+u+"|"+_;alldata.hasOwnProperty(y)||(alldata[y]={});for(var m=d+1;m<s.length;m++){if("undefined"==typeof c[m]){dlog.log("Error fetching "+e),dlog.log(c),dlog.log(r);continue}var v=c[m].trim(),D=s[m].trim();"ros"===e&&(D+=" Ros"),alldata[y][D]=v.replace(",","")}}}}function getPosProjections(){function e(e,t){parsePos("proj",t,e),a--,0===a&&(updated_times.proj=current_time,updated_types.proj=((experts.proj||{}).selection||"none").toString(),addData.run("proj"))}for(var t,a=all_positions_proj.length,r=0;r<all_positions_proj.length;r++)t=all_positions_proj[r],fetchPositionData(t,"proj",e)}function getPosRankings(){function e(e,t){if(parsePos("rank",t,e),a--,0===a){updated_times.rank=current_time;var r=experts.rank||{},n=r.num||{};updated_types.rank=(r.selection||"none").toString()+"-"+(n.top||0)+"-"+(n.updated||0),addData.run("rank")}}for(var t,a=all_positions_rank.length,r=0;r<all_positions_rank.length;r++)t=all_positions_rank[r],fetchPositionData(t,"rank",e)}function getRosRankings(){function e(e,t){if(parsePos("ros",t,e),a--,0===a){updated_times.ros=current_time;var r=experts.ros||{},n=r.num||{};updated_types.ros=(r.selection||"none").toString()+"-"+(n.top||0)+"-"+(n.updated||0),addData.run("ros")}}for(var t,a=all_positions_rank.length,r=0;r<all_positions_rank.length;r++)t=all_positions_rank[r],fetchPositionData(t,"ros",e)}function getPlayerCheckName(e,a,r,t){var n=null;return"proj"===t?n=e.toUpperCase()+"|"+a+"|"+r:"depth"==t&&(n=e.toUpperCase()),n}function fixPlayerPosition(e,t,a){var r={};return"proj"===a?r=player_position_fix:"depth"==a&&(r=player_position_fix_depth),player_name_fix.hasOwnProperty(e)&&(e=player_name_fix[e]),r.hasOwnProperty(e)&&(t=r[e]),"string"==typeof t&&t.indexOf(",EDR")?t=t.replace(",EDR",""):t.constructor===Array&&(t=t.filter(function(e){return"EDR"!==e})),t}function fixPlayerName(e,t,r,s,o){o="undefined"==typeof o?alldata:o;var l=t;t.constructor!==Array&&(l=[t]);for(var i=0;i<l.length;i++){if(t=l[i],"proj"===s&&("DT"===t||"DE"===t?t="DL":("CB"===t||"S"===t)&&(t="DB")),o.hasOwnProperty(getPlayerCheckName(e,t,r,s)))return[e,t];if(player_name_fix.hasOwnProperty(e)){var d=player_name_fix[e];if(o.hasOwnProperty(getPlayerCheckName(d,t,r,s)))return dlog.log("fixed name: "+e+"; is now: "+d),[d,t]}else{var p,c,u,_,h,f,g=[e],y=e.split(" "),m=y[0],v=y.slice(1).join(" ");if(m===m.toUpperCase()){if(u=m.split("").join(".")+". "+v,o.hasOwnProperty(getPlayerCheckName(u,t,r,s)))return dlog.log("fixed name: "+e+"; is now: "+u),[u,t];g.push(u)}var D=/( V| IV| III| II| Jr\.| Sr\.)$/;p=g.length;for(var w=0;w<p;w++){c=g[w];var k=c.match(D);if(k){var x=k[1];if(_=c.slice(0,c.indexOf(x)),o.hasOwnProperty(getPlayerCheckName(_,t,r,s)))return dlog.log("fixed name: "+e+"; is now: "+_),[_,t];g.push(_)}}p=g.length;for(var P=0;P<p;P++){c=g[P];var B=c.split(" "),b=B[0],C=B.slice(1).join(" ");if(player_name_translations.hasOwnProperty(b)){if(h=player_name_translations[b]+" "+C,o.hasOwnProperty(getPlayerCheckName(h,t,r,s)))return dlog.log("fixed name: "+e+"; is now: "+h),[h,t];g.push(h)}}var O=[" V"," IV"," III"," II"," Jr."," Sr."];p=g.length;for(var S=0;S<p;S++){c=g[S];for(var R=0;R<O.length;R++){if(f=c+O[R],o.hasOwnProperty(getPlayerCheckName(f,t,r,s)))return dlog.log("fixed name: "+e+"; is now: "+f),[f,t];g.push(f)}}}}return!1}function parseDepth(e){var t={},a="",r=jQuery("div.article-content > table > tbody> tr > td.la > table tbody tr",e);r.each(function(e,r){var n=jQuery(r),s=n.find("b");0==e%2?(a=s.text(),t[a]={}):s.each(function(e,r){var n=jQuery(r),s=n.text().replace(":","");"NT"===s?s="DT":("OLB"===s||"ILB"===s||"MLB"===s)&&(s="LB"),t[a].hasOwnProperty(s)||(t[a][s]={});var o=!1,l=1,i=n.nextUntil("br");i.each(function(e,r){if(o)return void(o=!1);o=!1;var d=jQuery(r),p=d.text().trim(),c=p,u=jQuery(i[e+1]).text().trim();u&&/^\(/.test(u)&&(o=!0,p+=" "+u);var _=[];if(-1<p.indexOf("(")){var h=p.match(/\([\w/]+\)/g);if(h&&h.length)for(var f=0;f<h.length;f++)_.push(h[f].replace(/[()]/g,"").toUpperCase());c=p.slice(0,p.indexOf(" ("))}c=c.replace(/[�′]+/g,"'"),player_name_fix.hasOwnProperty(c)&&(c=player_name_fix[c]);var g=c.toUpperCase(),y=d.find("font").addBack("font").attr("color");if(c.length){if(t[a][s].hasOwnProperty(g))return;t[a][s][g]={name:c,num:l,status:_,type:y}}l+=1})})}),depth_data[current_season]["W"+current_week]=t,depth_data_current_week=depth_data[current_season]["W"+current_week],updated_depth=current_time,addData.run("depth")}function getDepth(){chrome.runtime.sendMessage({query:"depth",data:{url:depth_url}},function(e){e=cleanHTML(e).trim(),parseDepth(e)})}function getPlayerData(){show_proj?getPosProjections():(projDone.resolve(),hasProjTotals?addData.projTotals():totalsDone.resolve()),show_rank?getPosRankings():rankDone.resolve(),show_ros?getRosRankings():rosDone.resolve()}function getAllData(e){e="undefined"==typeof e?["proj","rank","ros"]:e,show_proj||show_rank||show_ros?isDataCurrent(e)?(dlog.log("Using cache for player data"),addPlayerData()):(alldata={},updated_times={},updated_types={},updateStorage.player(),getPlayerData()):(projDone.resolve(),hasProjTotals?addData.projTotals():totalsDone.resolve(),rankDone.resolve(),rosDone.resolve()),show_avg||show_med||show_spark||show_current?(updateStorage.activity(),addData.run("adjavg")):activityDone.resolve(),show_depth?isDataCurrent("depth")?(dlog.log("Using cache for depth data"),addData.run("depth")):(dlog.log("resetting depth"),depth_data[current_season]["W"+current_week]={},depth_data_current_week=depth_data[current_season]["W"+current_week],updated_depth=0,updateStorage.depth(),getDepth()):depthDone.resolve()}var expected_player_pts={};function calculateProjections(e,t,a,r){var s=Math.round,o=Math.max;if("depth"===e)return[t,a,r];var l=t.toUpperCase();"DT"===a||"DE"===a?a="DL":("CB"===a||"S"===a)&&(a="DB"),a=fixPlayerPosition(t,a,"proj");var i;if("proj-default"===e)jQuery.isArray(a)&&(a=a[0]),"DT"===a||"DE"===a?a="DL":("CB"===a||"S"===a)&&(a="DB"),i=expected_player[a],isObj(i)||(i={});else{var d=l+"|"+a+"|"+r;if(i=alldata[d],"undefined"==typeof i){var p=fixPlayerName(t,a,r,"proj");if(p)t=p[0],a=p[1],l=t.toUpperCase(),d=l+"|"+a+"|"+r,i=alldata[d];else return dlog.log("Could not find player: "+d),"proj"===e?"--":["--","--"]}}if(dlog.info("player data: "),dlog.info(i),"proj-default"===e&&expected_player_pts.hasOwnProperty(a))return expected_player_pts[a];if("proj"===e||"proj-default"===e){for(var c,u=0,_=projDefs.settingNames,h=projDefs.defDict,f=projDefs.idpDict,g=projDefs.first_down_pct,y=0;y<_.length;y++)if(c=_[y],dlog.info(c),parseLeagueSettings.league_settings.hasOwnProperty(c)){var m=parseLeagueSettings.league_settings[c];dlog.info(m);var v=0;"pass_icmp"===c?v=o((i.pass_att||0)-(i.pass_cmp||0),0):"fgm"===c?v=o((i.fga||0)-(i.fg||0),0):"pass_firstdown"===c?g.pass.hasOwnProperty(a)&&(v=g.pass[a]*i.pass_att):"rush_firstdown"===c?g.rush.hasOwnProperty(a)&&(v=g.rush[a]*i.rush_att):"rec_firstdown"===c?g.rec.hasOwnProperty(a)&&(v=g.rec[a]*i.rec_att):v=i[c]||0,dlog.info(v);var D=m*v;dlog.info(D),u+=D;var w=calcBonus(c,v);dlog.info(w),u+=w}var x={};for(var P in"D/ST"===a?x=h:-1<idp_positions.indexOf(a)&&(x=f),x)if(x.hasOwnProperty(P)&&parseLeagueSettings.league_settings.hasOwnProperty(P)){var k=x[P];dlog.info(P+", "+k);var B=parseLeagueSettings.league_settings[P];dlog.info(B);var b=i[k]||0;dlog.info(b);var C=B*b;dlog.info(C),u+=C;var O=calcBonus(P,b);dlog.info(O),u+=O}return dlog.info(u),u+=calcAdjProjections(i),dlog.info("returning score: "),dlog.info(t+","+u),isNaN(u)?(dlog.log("bad player score"),u="--"):u=(s(10*u)/10).toFixed(1),"proj-default"===e&&(expected_player_pts[a]=u),u}if("rank"===e){if(parseFloat(i["Avg Rank"])){var S=(s(10*i["Avg Rank"])/10).toFixed(1),R=(s(1.96*(10*i["Std Dev"]))/10).toFixed(1);return[S,R]}return["--","--"]}if("ros"===e){if(parseFloat(i["Avg Rank Ros"])){var T=(s(10*i["Avg Rank Ros"])/10).toFixed(1),A=(s(1.96*(10*i["Std Dev Ros"]))/10).toFixed(1);return[T,A]}return["--","--"]}}function RowData(e,t){this.currRow=e,this.cell=t,this.player_cell=null,this.player_cell_text=null,this.player_name=null,this.pos_name=null,this.team_name=null,this.player_id=null,this.player_href=null,this.translation_id=null,this.translation_name=null,this.translation_pos=null,this.live_game=!1,this._init()}RowData.prototype._init=function(){return this.player_cell=this._getPlayerCell(),this.player_cell_text=this._getPlayerCellText(),this._isBlank()?{}:void Object.assign(this,this._getPlayerInfo())},RowData.prototype._getPlayerCell=function(){return this.currRow.find(player_name_selector)},RowData.prototype._getPlayerCellText=function(){return this.player_cell.text().trim()},RowData.prototype._getPlayerInfo=function(){},RowData.prototype.getTranslationId=function(){return null===this.translation_id?this.player_id:this.translation_id},RowData.prototype.getPlayerName=function(){return null===this.translation_name?this.player_name:this.translation_name},RowData.prototype.getPosName=function(){return null===this.translation_pos?this.pos_name:this.translation_pos},RowData.prototype._isBlank=function(){return!this.player_cell_text||"(Empty)"===this.player_cell_text},RowData.prototype._isUnpredictable=function(){return /(TQB|HC|P)$/.test(this.player_cell_text)},RowData.prototype._isNA=function(){return this._isBlank()||this._isUnpredictable()},RowData.prototype._isImmortal=function(){return /(D\/ST|TQB|HC)$/.test(this.player_cell_text)};var GetProjectionData=function(){var e=this;this.run=function(t,a,r){var n=new RowData(a,r);return"adjavg"===t?e.adjavg(n):e.other(n,t)},this._fetchActivityData=function(){},this.adjavg=function(t){var a,r=t.currRow,n=t.player_cell_text;if(show_avg?a=r.find("FantasyPlusAvgData").prev().text():show_med&&(a=r.find("FantasyPlusMedianData").prev().text()),!n||"--"===a)return insertAdjAvg(r,null,null,[],[]);var s=t.player_id;if(!s)return insertAdjAvg(r,null,null,[],[]);goodVal(activity_data_current_season_site,s,"object")||(activity_data_current_season_site[s]={});var o=activity_data_current_season_site[s];if(o.hasOwnProperty("translation")){var l=o.translation;dlog.log("found translation ID for: "+s+", is: "+l),t.translation_id=l}goodVal(o,"games_played","array")||(o.games_played=[]);var i=o.games_played;goodVal(o,"games_played_updated","number")||(o.games_played_updated=0);var d=o.games_played_updated;goodVal(o,league_id,"object")||(o[league_id]={});var p=o[league_id];goodVal(p,"weekly_points","array")||(p.weekly_points=[]);var c=p.weekly_points;p.hasOwnProperty("pts_avg")||(p.pts_avg=null);var u=p.pts_avg;p.hasOwnProperty("pts_med")||(p.pts_med=null);var _=p.pts_med;p.hasOwnProperty("last_updated")||(p.last_updated=0);var h=p.last_updated;return isActivityDataCurrent(s,h,"league",t.live_game)&&isActivityDataCurrent(s,d,"games")?(dlog.info("Using cache for player activity: "+s),insertAdjAvg(r,u,_,i,c)):void e._fetchActivityData(t)},this._popNA=function(e,t){return"rank"===t||"ros"===t?popCell(e,["--","--"],t):popCell(e,"--",t)},this._calcAndPop=function(e,t){var a=calculateProjections(t,e.getPlayerName(),e.getPosName(),e.team_name);return popCell(e.cell,a,t)},this.other=function(t,a){return t._isNA()?e._popNA(t.cell,a):e._calcAndPop(t,a)}},getProjectionData=new GetProjectionData;function insertAdjAvg(e,t,a,r,n){var s,o,l=Math.min,i=Math.max;if(show_avg&&(o=e.find(".FantasyPlusAvgData"),s=parseFloat(o.prev().text()),jQuery.isNumeric(t)?t>s?o.html("<span style=\"color:green\">"+t+"</span>"):o.text(t):o.text("--")),show_med&&(o=e.find(".FantasyPlusMedianData"),parseFloat(s)&&(s=parseFloat(t)),jQuery.isNumeric(a)?a>s?o.html("<span style=\"color:green\">"+a+"</span>"):a<s?o.html("<span style=\"color:red\">"+a+"</span>"):o.text(a):o.text("--")),show_current){var d=e.find(".FantasyPlusCurrentData"),p="--";n&&0<n.length?(current_season===current_season_avg_week&&jQuery.isNumeric(n[current_week-1])&&(p=n[current_week-1]),d.text(p)):d.text(p)}if(show_spark){var c=e.find(".FantasyPlusSparkData");if(!(n&&0<n.length))c.text("--");else{var u=new RowData(e,c),_=calculateProjections("proj-default",u.player_name,u.pos_name,u.team_name);dlog.info("we expect for pos: "+u.pos_name+", to get: "+_),jQuery.isNumeric(_)&&(_=+_);var h=_*(4/3),f=_*(2/3),g=h+":",y=f+":"+(h+""),m=":"+(f+""),v={null:"#999"};0===_?(v[g]="#5C5D5E",v[y]="#5C5D5E",v[m]="#5C5D5E"):(v[g]="#336600",v[y]="#FF6600",v[m]="#CC0000");var D=i(0,l(17,current_week_avg)-6),w=n.slice(D,l(i(0,current_week_avg-1),17));if(w&&1<w.length){var k={disableHiddenCheck:!0,width:"35px",height:"20px",chartRangeMin:0,tooltipSkipNull:!1,tooltipFormatter:function(e,t,a){var n,s=a.x,o=a.y,l=r[s+D];return n="BYE"===l?"Bye":0===l?"Out":Math.round(10*o)/10,"W"+(s+D+1)+": "+n},type:"line",fillColor:!1,lineColor:"gray",valueSpots:v,minSpotColor:!1,maxSpotColor:!1,spotColor:!1,spotRadius:2};"fleaflicker"===siteType&&(k.height="25px",k.width="40px",k.tooltipClassname="fp-jqstooltip"),c.sparkline(w,k)}else c.text("--")}}total_players--,0===total_players&&(dlog.log("avg done"),activityDone.resolve())}function canAddColumns(){return-1<header_index}var ReDefer=function(){this.run=function(){return canAddColumns()?void(projDone=jQuery.Deferred(),rankDone=jQuery.Deferred(),rosDone=jQuery.Deferred(),activityDone=jQuery.Deferred(),depthDone=jQuery.Deferred(),totalsDone=jQuery.Deferred()):void dlog.log("cant add columns")}},reDefer=new ReDefer;function addPlayerData(){canAddColumns()?(show_proj?addData.run("proj"):(projDone.resolve(),hasProjTotals?addData.projTotals():totalsDone.resolve()),show_rank?addData.run("rank"):rankDone.resolve(),show_ros?addData.run("ros"):rosDone.resolve()):(dlog.log("no header"),projDone.resolve(),rankDone.resolve(),rosDone.resolve(),totalsDone.resolve())}function addAllData(){canAddColumns()?(addPlayerData(),show_avg||show_med||show_spark||show_current?addData.run("adjavg"):activityDone.resolve(),show_depth?addData.run("depth"):depthDone.resolve()):(dlog.log("no header"),projDone.resolve(),rankDone.resolve(),rosDone.resolve(),activityDone.resolve(),depthDone.resolve(),totalsDone.resolve())}var isCurrentWeek=function(){return!0};jQuery.fn.nearest=function(e){var t,a=jQuery(this[0]),r=a.index(),n=a.parent().find(e),s=!1;return n.each(function(){var e=jQuery(this),a=e.index(),n=Math.abs(r-a);(!s||n<s)&&(s=n,t=e)}),t};function popCell(e,t,a){if("depth"===a)return insertDepth(e,t);if("rank"===a||"ros"===a){var r=t[0],n=t[1];return e.text(r),show_std&&("--"===r?e.next().text(n):e.next().html("<span style=\"font-size: 80%;\">\xB1</span>"+n)),null}return e.text(t)}var AddData=function(){var e=this;this.blank="-",this.byeweek_overwrite=null,this.isCurr=!1,this.selectors={proj:function(){return player_table_body.find(".FantasyPlusProjectionsData")},rank:function(){return player_table_body.find(".FantasyPlusRankingsData")},ros:function(){return player_table_body.find(".FantasyPlusRosData")},depth:function(){return player_table_body.find(".FantasyPlusDepthData")},adjavg:function(){return player_table_rows}},this.run=function(t){e.isCurr=isCurrentWeek();var a=e.selectors[t]();if("proj"===t)return e._proj(a);return"rank"===t?e._rank(a):"ros"===t?e._ros(a):"depth"===t?e._depth(a):"adjavg"===t?e._adjavg(a):void 0},this._iterData=function(t,a){a.each(function(){var a=jQuery(this);e._insert(t,a)})},this._insert=function(t,a){if(!e.isCurr&&-1<["proj","rank","ros"].indexOf(t))return a.text(e.blank);var r=a.parent();if("proj"===t||"rank"===t){var n=r.find("td:contains(\"** BYE **\")"),s=0<n.length;if("proj"===t&&e.byeweek_overwrite&&onMatchupPreviewPage&&n.html(e.byeweek_overwrite),s){var o="--";return"rank"===t&&(o=["--","--"]),popCell(a,o,t)}}return getProjectionData.run(t,r,a)},this.projTotals=function(){},this._proj=function(t){e._iterData("proj",t),dlog.log("proj done"),projDone.resolve(),e.isCurr&&hasProjTotals?e.projTotals():(dlog.log("totals done"),totalsDone.resolve())},this._rank=function(t){e._iterData("rank",t),dlog.log("rank done"),rankDone.resolve()},this._ros=function(t){e._iterData("ros",t),dlog.log("ros done"),rosDone.resolve()},this._depth=function(t){isObj(depth_data_current_week)||(dlog.log("Current week depth not set"),depth_fail=!0,depth_data_current_week={}),total_players_depth=t.length,0===total_players_depth&&depthDone.resolve(),e._iterData("depth",t),resetLeagueYear()},this._adjavg=function(e){total_players=player_table_rows.length,e.each(function(){var e=jQuery(this);getProjectionData.run("adjavg",e,"")}),resetLeagueYear()}},addData=new AddData;function insertDepth(e,t){if(t.constructor!==Array||3>t.length)e.text("--");else{var a=t[0],r=t[1],n=t[2],s=a.toUpperCase();r=fixPlayerPosition(a,r,"depth");var o="--";if("D/ST"===r)e.text("--");else if("FA"===n)e.text("--");else{n=Object.keys(team_abbrevs).filter(function(e){return team_abbrevs[e]===n})[0];var l={};depth_data_current_week.hasOwnProperty(n)&&(l=depth_data_current_week[n]);var i,d,c={};if(r.constructor===Array)for(var u=0;u<r.length;u++){var _=r[u],h={};if(l.hasOwnProperty(_))if(h=l[_],h.hasOwnProperty(s)){c=h,r=_,i=c[s],o=r+i.num;break}else if(d=fixPlayerName(a,_,n,"depth",h),d){a=d[0],r=d[1],s=a.toUpperCase(),c=h,i=c[s],i.true_name=a,o=r+i.num;break}}else if(l.hasOwnProperty(r))if(c=l[r],c.hasOwnProperty(s))i=c[s],o=r+i.num;else if(d=fixPlayerName(a,r,n,"depth",c),d)a=d[0],r=d[1],s=a.toUpperCase(),i=c[s],i.true_name=a,o=r+i.num;else if("RB"===r){var f={};l.hasOwnProperty("FB")&&(f=l.FB,f.hasOwnProperty(s)?(r="FB",c=f,i=c[s],o=r+i.num):(d=fixPlayerName(a,"FB",n,"depth",f),d&&(a=d[0],r=d[1],s=a.toUpperCase(),c=f,i=c[s],i.true_name=a,o=r+i.num)))}"--"===o&&dlog.log("Could not get depth for player: "+t[0]),e.text(o);var g=Object.keys(c).sort(function(e,t){return c[e].num-c[t].num});if(g.length){for(var y="",m=0;m<g.length;m++){var v=g[m],D=c[v],w=depth_type_map[D.type],k=D.num,x=D.status,P=x.join("|"),B=D.name,b=B;D.hasOwnProperty("true_name")&&(b=D.true_name);var C="<tr>";b.toUpperCase()===a.toUpperCase()&&(C="<tr style=\"background-color: lightblue\">"),y+=C+"<td style=\"width: 40px;\">"+r+k+":</td><td style=\"width: 140px;\">"+B+"</td><td style=\"width: 90px;\">"+w+"</td><td style=\"width: 80px;\">"+P+"</td></tr>"}var O=jQuery("<div><table><tbody></tbody></table></div>");O.find("tbody").append(y),e.css({cursor:"pointer"}),e.tooltipster({content:O,contentCloning:!1,delay:100,debug:!0,interactive:!0,theme:"tooltipster-light",side:"right"})}else dlog.log("No team data for pos: "+r),dlog.log(l)}}total_players_depth--,0===total_players_depth&&(dlog.log("depth done"),depthDone.resolve())}function _resetTranslation(){}function refreshData(e){dlog.log("rerunning"),observer_disconned=!0,observer&&observer.disconnect(),jQuery(".FantasyPlus").remove(),setSelectors(),reDefer.run(),addColumns(),!0===e?(updated_times={},updated_types={},updated_depth=0,!isObj(activity_data)&&(activity_data={}),!activity_data.hasOwnProperty(current_season)&&(activity_data[current_season]={}),activity_data[current_season][siteType]={},activity_data_current_season_site=activity_data[current_season][siteType],_resetTranslation(),dlog.log("Refreshing data, Current Time: "+current_time),jQuery.get(league_settings_url,function(e){e=cleanHTML(e);var t=parseLeagueSettings.run(e),a={};a[storageLeagueKey]=t,a[storageLeagueUpdateKey]=updated_league,chrome.storage.local.set(a,function(){setWatch.run(),runGetAllData.run()})})):addAllData()}var WatchForChanges=function(){var e=this;this.target_selector=null,this.observerConfig={childList:!0,characterData:!0,subtree:!0},this._getAcceptedChange=function(){return!0},this._handleMutations=function(e){e?refreshData():dlog.log("rejected mutation")},this.run=function(){if(hasPlayerTable){dlog.log("init watch");var t=document.querySelector(e.target_selector);return null===t?void dlog.log("Not attaching observer"):void(observer=new MutationObserver(function(a){if(observer_disconned=!1,0<a.length){var r=e._getAcceptedChange(a);e._handleMutations(r)}observer_disconned&&(dlog.log("disconned, reattaching"),jQuery.when(projDone,rankDone,rosDone,activityDone,depthDone,totalsDone).done(function(){dlog.log("all done"),dlog.log("watching for changes after finishing"),t=document.querySelector(e.target_selector),observer.observe(t,e.observerConfig)}))}),dlog.log("watching for changes"),observer.observe(t,e.observerConfig))}}},watchForChanges=new WatchForChanges;chrome.runtime.onMessage.addListener(function(e,t,a){var r=e.request;"refresh_data"===r&&(refreshData(!0),a("ok"))});